<!doctype html><html lang=ja class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.74.2"><meta name=description content="Documentation of GIS for Water"><meta name=author content="Jin IGARASHI"><link rel=icon href=/images/favicon.png type=image/png><title>ベクトルタイルのgh-pagesへのデプロイ :: GIS for Waterドキュメンテーション</title><link href=/css/nucleus.css?1602307973 rel=stylesheet><link href=/css/fontawesome-all.min.css?1602307973 rel=stylesheet><link href=/css/hybrid.css?1602307973 rel=stylesheet><link href=/css/featherlight.min.css?1602307973 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1602307973 rel=stylesheet><link href=/css/auto-complete.css?1602307973 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1602307973 rel=stylesheet><link href=/css/theme.css?1602307973 rel=stylesheet><link href=/css/hugo-theme.css?1602307973 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1602307973></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/ja/setups/installation/deploy_vectortiles/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=/><div style=font-size:x-large;font-weight:700;color:#fff>GIS for Water</div></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=検索...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1602307973></script><script type=text/javascript src=/js/auto-complete.js?1602307973></script><script type=text/javascript>var baseurl="https:\/\/docs.water-gis.com\/ja";</script><script type=text/javascript src=/js/search.js?1602307973></script></div><div class=highlightable><ul class=topics><li data-nav-id=/ja/concept/ title=コンセプト class=dd-item><a href=/ja/concept/><b>1. </b>コンセプト</a></li><li data-nav-id=/ja/setups/ title=セットアップ class="dd-item
parent"><a href=/ja/setups/><b>2. </b>セットアップ</a><ul><li data-nav-id=/ja/setups/preparation/ title=事前準備 class=dd-item><a href=/ja/setups/preparation/>事前準備</a><ul><li data-nav-id=/ja/setups/preparation/install_postgis/ title=PostgresSQL/PostGISデータベースのインストール class=dd-item><a href=/ja/setups/preparation/install_postgis/>PostgresSQL/PostGISデータベースのインストール</a></li><li data-nav-id=/ja/setups/preparation/data_collection/ title=データ収集と、データのPostGISへの投入 class=dd-item><a href=/ja/setups/preparation/data_collection/>データ収集と、データのPostGISへの投入</a></li><li data-nav-id=/ja/setups/preparation/install_docker/ title=Dockerのインストール class=dd-item><a href=/ja/setups/preparation/install_docker/>Dockerのインストール</a></li></ul></li><li data-nav-id=/ja/setups/installation/ title=インストール class="dd-item
parent"><a href=/ja/setups/installation/>インストール</a><ul><li data-nav-id=/ja/setups/installation/create_vt_repository/ title=ベクトルタイル用のリポジトリ作成 class=dd-item><a href=/ja/setups/installation/create_vt_repository/>ベクトルタイル用のリポジトリ作成</a></li><li data-nav-id=/ja/setups/installation/create_mbtiles/ title=PostGISからmbtilesを生成する class=dd-item><a href=/ja/setups/installation/create_mbtiles/>PostGISからmbtilesを生成する</a></li><li data-nav-id=/ja/setups/installation/design_stylefile/ title=Mapboxスタイルのデザイン class=dd-item><a href=/ja/setups/installation/design_stylefile/>Mapboxスタイルのデザイン</a></li><li data-nav-id=/ja/setups/installation/deploy_vectortiles/ title=ベクトルタイルのgh-pagesへのデプロイ class="dd-item
parent
active"><a href=/ja/setups/installation/deploy_vectortiles/>ベクトルタイルのgh-pagesへのデプロイ</a></li><li data-nav-id=/ja/setups/installation/deploy_stylefile_sprite/ title=Mapboxスタイルファイルとスプライトファイルのgh-pagesへのデプロイ class=dd-item><a href=/ja/setups/installation/deploy_stylefile_sprite/>Mapboxスタイルファイルとスプライトファイルのgh-pagesへのデプロイ</a></li><li data-nav-id=/ja/setups/installation/develop_mapbox_gl_js/ title=ウェブアプリの開発とデプロイ class=dd-item><a href=/ja/setups/installation/develop_mapbox_gl_js/>ウェブアプリの開発とデプロイ</a></li></ul></li></ul></li><li data-nav-id=/ja/operation/ title=ベクトルタイルの運用 class=dd-item><a href=/ja/operation/><b>3. </b>ベクトルタイルの運用</a><ul><li data-nav-id=/ja/operation/automation_updating/ title=データ更新の自動化 class=dd-item><a href=/ja/operation/automation_updating/>データ更新の自動化</a></li><li data-nav-id=/ja/operation/costs/ title=コスト class=dd-item><a href=/ja/operation/costs/>コスト</a><ul><li data-nav-id=/ja/operation/costs/costs_ghpages/ title="GitHub Pagesのホスティングサービス" class=dd-item><a href=/ja/operation/costs/costs_ghpages/>GitHub Pagesのホスティングサービス</a></li><li data-nav-id=/ja/operation/costs/cost_basemaps/ title=サードパーティのベースマップの制限事項 class=dd-item><a href=/ja/operation/costs/cost_basemaps/>サードパーティのベースマップの制限事項</a></li></ul></li></ul></li><li data-nav-id=/ja/casestudies/ title=ケーススタディ class=dd-item><a href=/ja/casestudies/><b>4. </b>ケーススタディ</a><ul><li data-nav-id=/ja/casestudies/narok/ title=ケニア・ナロックウォーター class=dd-item><a href=/ja/casestudies/narok/>ケニア・ナロックウォーター</a></li><li data-nav-id=/ja/casestudies/wasac/ title=ルワンダ・WASAC class=dd-item><a href=/ja/casestudies/wasac/>ルワンダ・WASAC</a></li><li data-nav-id=/ja/casestudies/nakuru/ title=ケニア・ナクルウォーター class=dd-item><a href=/ja/casestudies/nakuru/>ケニア・ナクルウォーター</a></li><li data-nav-id=/ja/casestudies/nanyuki/ title=ケニア・ナニュキウォーター class=dd-item><a href=/ja/casestudies/nanyuki/>ケニア・ナニュキウォーター</a></li></ul></li><li data-nav-id=/ja/packages/ title=パッケージとライブラリ class=dd-item><a href=/ja/packages/><b>5. </b>パッケージとライブラリ</a></li><li data-nav-id=/ja/license/ title=ライセンス class=dd-item><a href=/ja/license/><b>6. </b>ライセンス</a></li></ul><section id=shortcuts><h3>更に</h3><ul><li><a class=padding href=https://github.com/watergis/docs><i class="fab fa-fw fa-github"></i>GitHubリポジトリ</a></li><li><a class=padding href=https://docs.water-gis.com/ja/showcase><i class="fas fa-fw fa-camera"></i>ショーケース</a></li><li><a class=padding href=https://docs.water-gis.com/ja/tools><i class="fas fa-tools"></i>サードパーティのツール</a></li><li><a class=padding href=https://docs.water-gis.com/ja/credits><i class="fas fa-fw fa-bullhorn"></i>クレジット</a></li><li><a class=padding href=https://water-gis.com><i class="fas fa-address-card"></i>連絡先</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value;">
<option id=en value=https://docs.water-gis.com/en/setups/installation/deploy_vectortiles/>English</option>
<option id=ja value=https://docs.water-gis.com/ja/setups/installation/deploy_vectortiles/ selected>日本語</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li></ul></section><section id=footer><center><a class=github-button href=https://github.com/watergis/docs data-icon=octicon-star data-show-count=true aria-label="Star watergis/docs on GitHub">Star</a>
<a class=github-button href=https://github.com/watergis/docs/fork data-icon=octicon-repo-forked data-show-count=true aria-label="Fork watergis/docs on GitHub">Fork</a>
<a class=github-button href=https://github.com/sponsors/JinIgarashi aria-label="Sponsor watergis OSS project on GitHub">Sponsor</a><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a>from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p><p>Copyright © 2020 Jin IGARASHI</p></center><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title=このページを編集 href=https://github.com/watergis/docs/edit/master/content/setups/installation/deploy_vectortiles/_index.ja.md target=blank><i class="fas fa-code-branch"></i><span id=top-github-link-text>このページを編集</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/ja/>GIS for Water</a> > <a href=/ja/setups/>セットアップ</a> > <a href=/ja/setups/installation/>インストール</a> > ベクトルタイルのgh-pagesへのデプロイ</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#ベクトルタイルのgh-pagesへのデプロイvtで作業>ベクトルタイルのgh-pagesへのデプロイ(<code>vt</code>で作業)</a><ul><li><a href=#i-narwasscovt-mapアプローチ-ケニアのナロックウォーターの場合>i. [narwassco/vt-mapアプローチ] ケニアのナロックウォーターの場合</a></li><li><a href=#ii-wasacvtアプローチ-ルワンダのwasacの場合-推奨>ii. [WASAC/vtアプローチ] ルワンダのWASACの場合 (推奨)</a></li></ul></li><li><a href=#ベクトルタイルの容量がgh-pagesのキャパを超える場合>ベクトルタイルの容量がgh-pagesのキャパを超える場合</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>ベクトルタイルのgh-pagesへのデプロイ</h1><h2 id=ベクトルタイルのgh-pagesへのデプロイvtで作業>ベクトルタイルのgh-pagesへのデプロイ(<code>vt</code>で作業)</h2><p>スタイルファイルのデザインとmbtilesが完成したら、いよいよベクトルタイルをgh-pagesにデプロイします。<a href=https://github.com/watergis/postgis2vectortiles>postgis2vectortiles</a>のモジュールがベクトルタイルの生成とデプロイを一貫して行なってくれます。</p><p>デプロイするには二つのケースがあります。</p><div class=mermaid align=center>graph LR
A[mbtiles] --> B{対象エリアは大きいですか?}
B -->|いいえ|C[narwassco/vt-map]
B -->|はい|D[wasac/vt]
C -->|ローカルでタイルを生成します|E[gh-pages]
D -->|mbtilesをアップロード|F[github masterブランチ]
F -->|Github Actionsでタイルを生成します|E</div><h3 id=i-narwasscovt-mapアプローチ-ケニアのナロックウォーターの場合>i. [narwassco/vt-mapアプローチ] ケニアのナロックウォーターの場合</h3><p>もし対象エリアが狭い場合は、<code>ナロックウォーター</code>のアプローチでデプロイすることができます。次のリポジトリを参照してください。</p><ul><li><a href=https://github.com/narwassco/vt-map>narwassco/vt-map</a>
これは次のモジュールを使用してMapboxベクトルタイルを生成し、gh-pagesにデプロイします。<ul><li><a href=https://github.com/watergis/postgis2mbtiles>watergis/postgis2mbtiles</a>: PostGISから<code>mbtiles</code>を生成します。</li><li><a href=https://github.com/watergis/mbtiles2pbf>watergis/mbtiles2pbf</a>: <code>mbtiles</code>を<code>pbf(mvt)</code>タイルに変換します。</li></ul></li></ul><p>このモジュールは<a href=https://github.com/mapbox/tippecanoe>mapbox/tippecanoe</a>を使用してmbtilesを生成します。しかしながら、ナロックウォーターのGISマシンはWindows10 Proのため、<code>tippecanoe</code>の実行が困難であり、<code>Docker</code>を使用してベクトルタイルを生成するツールを開発しました。</p><h3 id=ii-wasacvtアプローチ-ルワンダのwasacの場合-推奨>ii. [WASAC/vtアプローチ] ルワンダのWASACの場合 (推奨)</h3><p>もし対象エリアが広い場合は、Github pagesに数千のベクトルタイルをデプロイすることは容易ではないでしょう。<code>WASAC</code>のアプローチを使って、<code>mbtiles</code>を先にアップロードした後、<code>Github Actions</code>で<code>mbtiles</code>からベクトルタイルを取り出すと良いです。次に示すリポジトリをご覧になってください。</p><ul><li><a href=https://github.com/WASAC/vt>WASAC/vt</a>
これは次のモジュールを使用してMapboxベクトルタイルを生成し、gh-pagesにデプロイします。<ul><li><a href=https://github.com/watergis/postgis2mbtiles>watergis/postgis2mbtiles</a>: PostGISから<code>mbtiles</code>を生成します。 <code>postgis2mbtiles</code>モジュールはローカルマシンに実行します。</li><li><a href=https://github.com/watergis/mbtiles2pbf>watergis/mbtiles2pbf</a>: <code>mbtiles</code>を<code>pbf(mvt)</code>タイルに変換します。 <code>mbtiles2pbf</code>は<code>Github Actions</code>で実行します。</li></ul></li></ul><p>次のものは<code>ナロックウォーター</code>が使用している<code>Github Actions</code>でmbtilesタイルからpbfタイルを生成しデプロイするためのワークフローファイルです。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#66d9ef>name</span>: Node.js CI

<span style=color:#66d9ef>on</span>:
  <span style=color:#66d9ef>push</span>:
    <span style=color:#66d9ef>branches</span>: [ master ]

<span style=color:#66d9ef>jobs</span>:
  <span style=color:#66d9ef>build</span>:

    <span style=color:#66d9ef>runs-on</span>: ubuntu-latest

    <span style=color:#66d9ef>steps</span>:
    - <span style=color:#66d9ef>uses</span>: actions/checkout@v2
    - <span style=color:#66d9ef>name</span>: Use Node.js
      <span style=color:#66d9ef>uses</span>: actions/setup-node@v1
      <span style=color:#66d9ef>with</span>:
        <span style=color:#66d9ef>node-version</span>: <span style=color:#ae81ff>12.</span>x
    - <span style=color:#66d9ef>run</span>: npm ci
      <span style=color:#66d9ef>env</span>:
        <span style=color:#66d9ef>NODE_AUTH_TOKEN</span>: ${{secrets.GITHUB_TOKEN}}
    - <span style=color:#66d9ef>run</span>: npm run extract
    - <span style=color:#66d9ef>name</span>: configure git and deploy
      <span style=color:#66d9ef>env</span>:
        <span style=color:#66d9ef>NODE_AUTH_TOKEN</span>: ${{secrets.GITHUB_TOKEN}}
      <span style=color:#66d9ef>run</span>: <span style=color:#e6db74>|
</span><span style=color:#e6db74>        git config --global user.name &#34;narwassco+githubci&#34;</span>
        git config --global user.email <span style=color:#e6db74>&#34;narwassco+githubci@users.noreply.github.com&#34;</span>
        git remote set-url origin https://x-access-token:${NODE_AUTH_TOKEN}@github.com/narwassco/vt.git
        npm run deploy
</code></pre></div><ul><li><p><code>ナロックウォーター</code>も[<code>narwassco/vt-map</code>アプローチ]の代わりに、[<code>WASAC/vt</code>アプローチ]を使い始めました。</p><ul><li><a href=https://github.com/narwassco/vt>narwassco/vt</a></li></ul></li><li><p><code>ナクルウォーター</code>も[<code>WASAC/vt</code>アプローチ]を使い始めました。</p><ul><li><a href=https://github.com/nakuruwater/vt>nakuruwater/vt</a></li></ul></li></ul><h2 id=ベクトルタイルの容量がgh-pagesのキャパを超える場合>ベクトルタイルの容量がgh-pagesのキャパを超える場合</h2><p>Github Pagesは最大で1GBの容量制限があります。もしこの制限をデータサイズが超えるようなら、gh-pagesへデプロイすることはできません。</p><p>しかしながら、もしかしたら<a href=https://www.netlify.com>Netlify</a>を使うというオプションがあるかもしれません。</p><p>ルワンダでは、ベースマップとしてParcels（筆）データを追加したいという要望がありました。ルワンダ全国のParcelsデータは元々シェープファイルで8GB、pbfのベクトルタイルに変換したところ1.2GBほどになりました。しかしながら、Netlifyを用いてParcelsをデプロイすることに成功しています。</p><p>どのように大きなベクトルタイルをNetlifyにデプロイできたか、次のリポジトリが参考になるでしょう。</p><ul><li><a href=https://github.com/WASAC/vt-parcels-2020>WASAC/vt-parcels-2020</a>: 2020年7月21日時点の最新のルワンダのParcelsデータ</li><li><a href=https://github.com/WASAC/vt-parcels>WASAC/vt-parcels</a>: 2019年以前の古いルワンダのParcelsデータ(正確なデータの日付は不明)</li></ul><p>Parcelsデータが非常に巨大であったため、PostGISからGeoJSONを取り出して<strong>tippecanoe</strong>を使用することができませんでした。そのためこのケースでは、<a href=https://github.com/watergis/mvt-generator>watergis/mvt-generator</a>というモジュールを開発し、PostGISから直接pbfタイルを作成することにしました。<strong>vt</strong>リポジトリで行っていることとはちょっと違うアプローチになっています。</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/ja/setups/installation/design_stylefile/ title=Mapboxスタイルのデザイン><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/ja/setups/installation/deploy_stylefile_sprite/ title=Mapboxスタイルファイルとスプライトファイルのgh-pagesへのデプロイ style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1602307973></script><script src=/js/perfect-scrollbar.min.js?1602307973></script><script src=/js/perfect-scrollbar.jquery.min.js?1602307973></script><script src=/js/jquery.sticky.js?1602307973></script><script src=/js/featherlight.min.js?1602307973></script><script src=/js/highlight.pack.js?1602307973></script><script>hljs.initHighlightingOnLoad();</script><script src=/js/modernizr.custom-3.6.0.js?1602307973></script><script src=/js/learn.js?1602307973></script><script src=/js/hugo-learn.js?1602307973></script><link href=/mermaid/mermaid.css?1602307973 rel=stylesheet><script src=/mermaid/mermaid.js?1602307973></script><script>mermaid.initialize({startOnLoad:true});</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-170080825-6','auto');ga('send','pageview');</script></body></html>